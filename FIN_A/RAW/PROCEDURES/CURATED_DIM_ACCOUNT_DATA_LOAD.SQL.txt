CREATE OR REPLACE PROCEDURE FIN_A.RAW.CURATED_DIM_ACCOUNT_DATA_LOAD()
RETURNS VARCHAR
LANGUAGE SQL
EXECUTE AS OWNER
AS '
    BEGIN
        INSERT INTO FIN_A.SCH.DIM_ACCOUNT
        SELECT * EXCLUDE ACTN_CD FROM FIN_A.TRA.DIM_ACCOUNT WHERE ACTN_CD=''I'';

        LET I_CNT NUMBER := SQLROWCOUNT;

        LET N_CNT NUMBER := 0;

        SELECT COUNT(*) INTO :N_CNT FROM FIN_A.TRA.DIM_ACCOUNT WHERE ACTN_CD=''N'';

        UPDATE FIN_A.SCH.DIM_ACCOUNT C
        SET C.ACCOUNT_TYPE=T.ACCOUNT_TYPE,
            C.CURRENCY=T.CURRENCY,
            C.OPENING_DATE=T.OPENING_DATE,
            C.OPENING_BALANCE=T.OPENING_BALANCE,
            C.ACCOUNT_STATUS=T.ACCOUNT_STATUS
        FROM FIN_A.TRA.DIM_ACCOUNT T
        WHERE ACTN_CD=''U'' AND T.ACCOUNT_ID=C.ACCOUNT_ID;
        
        LET U_CNT NUMBER := SQLROWCOUNT;
        
        RETURN '' INSERT : '' || I_CNT || '' NO CHANGE : '' || N_CNT || '' UPDATE : '' || U_CNT;
    END;
';