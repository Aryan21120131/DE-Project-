CREATE OR REPLACE PROCEDURE FIN_A.RAW.CUSTOMER_DATA_LOAD()
RETURNS VARCHAR
LANGUAGE SQL
EXECUTE AS OWNER
AS '
    BEGIN
        INSERT INTO FIN_A.SCH.DIM_CUSTOMER
        SELECT * EXCLUDE ACTN_CD
        FROM FIN_A.TRA.DIM_CUSTOMER R
        WHERE R.ACTN_CD=''I'';

        LET I_CNT NUMBER := SQLROWCOUNT;

        LET N_CNT NUMBER;
        SELECT COUNT(*) INTO :N_CNT FROM FIN_A.TRA.DIM_CUSTOMER WHERE ACTN_CD=''N'';

        UPDATE FIN_A.SCH.DIM_CUSTOMER C
        SET C.CUSTOMER_NAME=R.CUSTOMER_NAME,C.CUSTOMER_TYPE=R.CUSTOMER_TYPE,C.DATE_OF_BIRTH=R.DATE_OF_BIRTH,C.GENDER=R.GENDER,
            C.PAN_NUMBER=R.PAN_NUMBER,C.AADHAAR_NUMBER=R.AADHAAR_NUMBER,C.EMAIL=R.EMAIL,C.MOBILE_NUMBER=R.MOBILE_NUMBER,C.ADDRESS=R.ADDRESS,
            C.CITY=R.CITY,C.STATE=R.STATE,C.COUNTRY=R.COUNTRY,C.RISK_CATEGORY=R.RISK_CATEGORY
        FROM FIN_A.TRA.DIM_CUSTOMER R
        WHERE C.CUSTOMER_ID=R.CUSTOMER_ID AND R.ACTN_CD=''U'';
        
        LET U_CNT NUMBER := SQLROWCOUNT;
        
        RETURN ''INSERT : '' || I_CNT || '' NO CHANGE : '' || N_CNT || '' UPDATE : ''|| U_CNT;
        
    END;
';